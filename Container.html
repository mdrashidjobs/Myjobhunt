<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Job JSON Parser Enhanced</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
textarea { width: 100%; height: 400px; }
button { padding: 10px 20px; margin-top: 10px; }
pre { background: #eee; padding: 10px; overflow-x: auto; }
</style>
</head>
<body>

<h2>Enhanced Job JSON Parser</h2>
<p>Paste WhatsApp jobs (like your daily format) and click Parse â†’ Generate jobs.json</p>
<textarea id="jobInput"></textarea>
<br>
<button id="parseBtn">Parse & Download JSON</button>

<h3>Preview JSON</h3>
<pre id="jsonPreview"></pre>

<script>
document.getElementById('parseBtn').addEventListener('click', () => {
  const rawText = document.getElementById('jobInput').value;
  const today = new Date().toLocaleDateString('en-GB', {day:'numeric', month:'long', year:'numeric'});
  let jobsObj = { [today]: {} };

  const lines = rawText.split('\n');
  let currentCategory = '';
  let currentJob = null;

  lines.forEach(line => {
    line = line.trim();

    // Detect category
    if(line.startsWith('ðŸ“Œ') && line.includes('Roles')) {
      currentCategory = line.replace('ðŸ“Œ','').replace('Roles','').trim().toLowerCase();
      if(!jobsObj[today][currentCategory]) jobsObj[today][currentCategory] = [];
      currentJob = null;
      return;
    }

    // Detect new job start
    if(line.startsWith('ðŸ“Œ') && !line.includes('Roles')) {
      if(currentCategory === '') currentCategory = 'misc';
      if(!jobsObj[today][currentCategory]) jobsObj[today][currentCategory] = [];

      currentJob = { title: line.replace('ðŸ“Œ','').trim() };
      jobsObj[today][currentCategory].push(currentJob);
      return;
    }

    if(!currentJob) return; // Skip lines until first job

    // Extract known fields
    if(line.startsWith('Location:')) currentJob.location = line.replace('Location:','').trim();
    else if(line.startsWith('ðŸ’¼ Details:') || line.startsWith('Details:')) currentJob.details = line.replace(/ðŸ’¼ Details:|Details:/,'').trim();
    else if(line.startsWith('âœ… Requirements:') || line.startsWith('Requirements:')) currentJob.requirements = line.replace(/âœ… Requirements:|Requirements:/,'').trim();
    else if(line.startsWith('ðŸ’° Salary:') || line.startsWith('Salary:')) currentJob.salary = line.replace(/ðŸ’° Salary:|Salary:/,'').trim();
    else if(line.startsWith('ðŸ“© Apply:') || line.startsWith('ðŸ“± Apply')) currentJob.apply = line.replace(/ðŸ“© Apply:|ðŸ“± Apply via WhatsApp:|ðŸ“± Apply:/,'').trim();
  });

  const jsonStr = JSON.stringify(jobsObj, null, 2);
  document.getElementById('jsonPreview').textContent = jsonStr;

  // Download JSON
  const blob = new Blob([jsonStr], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'jobs.json';
  a.click();
});
</script>

</body>
</html>
