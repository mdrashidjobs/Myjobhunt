<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Job Parser Download</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9; }
textarea { width: 100%; height: 300px; font-family: monospace; font-size: 14px; padding: 10px; }
button { margin-top: 10px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
</style>
</head>
<body>

<h2>ðŸ“Œ Job Parser</h2>
<p>Paste all new jobs below. Use format <code>Category: job details</code> (e.g., Admin: ðŸ“Œ Secretary â€“ Flower Shop...). Click <b>Save JSON</b> to download <code>jobs.json</code>.</p>

<textarea id="input" placeholder="Paste jobs here..."></textarea>
<br>
<button id="save">Save JSON</button>

<script>
document.getElementById("save").addEventListener("click", function () {
  let text = document.getElementById("input").value.trim();
  if(!text) return alert("No jobs to save!");

  const today = new Date().toISOString().split("T")[0];
  const lines = text.split("\n").filter(line => line.trim() !== "");
  const categories = ["Admin", "Finance", "IT", "Engineering", "Safety", "Healthcare", "Sales", "Drivers"];

  fetch("jobs.json")
    .then(r => r.json())
    .catch(() => ({}))
    .then(data => {
      if(!data[today]) data[today] = {};
      // Ensure all categories exist
      categories.forEach(cat => { if(!data[today][cat]) data[today][cat] = []; });

      lines.forEach(line => {
        let matched = false;
        categories.forEach(cat => {
          const prefix = cat + ":";
          if(line.startsWith(prefix) || line.startsWith(prefix + " ")) {
            data[today][cat].push(line.slice(prefix.length).trim());
            matched = true;
          }
        });
        if(!matched){
          console.warn("Skipped line (category not found):", line);
        }
      });

      const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "jobs.json";
      a.click();
      URL.revokeObjectURL(url);

      alert("âœ… jobs.json downloaded successfully!");
    });
});
</script>

</body>
</html>
