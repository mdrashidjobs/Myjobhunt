<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Job Parser Download</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9; }
textarea { width: 100%; height: 300px; font-family: monospace; font-size: 14px; padding: 10px; }
button { margin-top: 10px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
</style>
</head>
<body>

<h2>ðŸ“Œ Job Parser</h2>
<p>Paste all new jobs below. Click <b>Save JSON</b> to download <code>jobs.json</code>. Old jobs will be preserved.</p>

<textarea id="input" placeholder="Paste jobs here..."></textarea>
<br>
<button id="save">Save JSON</button>

<script>
document.getElementById("save").addEventListener("click", function () {
  let text = document.getElementById("input").value.trim();
  if(!text) return alert("No jobs to save!");

  const today = new Date().toISOString().split("T")[0];
  const categories = {
    "Admin": ["Secretary","Admin","Assistant","Operations"],
    "Finance": ["Finance","Accounting","Manager","CFO","Accountant"],
    "IT": ["IT","Developer","Technician","Odoo","CRM","Network"],
    "Engineering": ["Engineer","Mechanical","Civil","Electrical","HVAC","Estimator","Technical"],
    "Safety": ["Safety","NEBOSH","Security","Supervisor","Officer"],
    "Healthcare": ["Doctor","Nurse","Medical","Optometrist","Dietitian","Laboratory","Vet","Clinic"],
    "Sales": ["Sales","Marketing","Retail","Store","Representative","Supervisor"],
    "Drivers": ["Driver","Delivery","Transport","Heavy","Light"]
  };

  fetch("jobs.json").then(r => r.json()).catch(()=>({})).then(data=>{
    if(!data[today]) data[today] = {};
    Object.keys(categories).forEach(cat=>{ if(!data[today][cat]) data[today][cat]=[]; });

    // Split job blocks by double newlines
    const jobBlocks = text.split(/\n{2,}/).map(j=>j.trim()).filter(j=>j!=="");

    jobBlocks.forEach(job=>{
      let added=false;
      for(const cat in categories){
        if(categories[cat].some(keyword=>job.toLowerCase().includes(keyword.toLowerCase()))){
          data[today][cat].push(job);
          added=true;
          break;
        }
      }
      if(!added) console.warn("Category not found for job:", job);
    });

    const blob = new Blob([JSON.stringify(data,null,2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href=url;
    a.download="jobs.json";
    a.click();
    URL.revokeObjectURL(url);

    alert("âœ… jobs.json downloaded successfully!");
  });
});
</script>

</body>
</html>
