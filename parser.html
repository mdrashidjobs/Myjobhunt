<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Job Parser Download</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9; }
textarea { width: 100%; height: 300px; font-family: monospace; font-size: 14px; padding: 10px; }
button { margin-top: 10px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
</style>
</head>
<body>

<h2>ðŸ“Œ Job Parser</h2>
<p>Paste all new jobs below. Use format <code>Category: job details</code>. Click <b>Save JSON</b> to download <code>jobs.json</code>.</p>

<textarea id="input" placeholder="Example: Admin: ðŸ“Œ Secretary â€“ Flower Shop, Farwaniya, Al-Rai..."></textarea>
<br>
<button id="save">Save JSON</button>

<script>
document.getElementById("save").addEventListener("click", function () {
  let text = document.getElementById("input").value.trim();
  if(!text) return alert("No jobs to save!");

  const today = new Date().toISOString().split("T")[0];
  const lines = text.split("\n").filter(line => line.trim() !== "");
  const categories = ["Admin", "Finance", "IT", "Engineering", "Safety", "Healthcare", "Sales", "Drivers"];

  fetch("jobs.json")
    .then(r => r.json())
    .catch(() => ({}))
    .then(data => {
      if(!data[today]) data[today] = {};
      categories.forEach(cat => { if(!data[today][cat]) data[today][cat] = []; });

      lines.forEach(line => {
        const splitIndex = line.indexOf(":");
        if(splitIndex === -1) return;
        const cat = line.slice(0, splitIndex).trim();
        const job = line.slice(splitIndex + 1).trim();
        if(categories.includes(cat)) data[today][cat].push(job);
      });

      const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "jobs.json";
      a.click();
      URL.revokeObjectURL(url);

      alert("âœ… jobs.json downloaded successfully!");
    });
});
</script>

</body>
</html>
