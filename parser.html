<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Job Parser</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
textarea { width: 100%; height: 300px; }
button { margin-top: 10px; padding: 10px 20px; cursor: pointer; }
</style>
</head>
<body>
<h1>Job Parser</h1>
<p>Paste your WhatsApp jobs text below:</p>
<textarea id="jobInput"></textarea>
<br>
<button onclick="parseJobs()">Parse & Download JSON</button>

<script>
function parseJobs() {
    const rawText = document.getElementById('jobInput').value.trim();
    if(!rawText) { alert('Paste job data first!'); return; }

    const lines = rawText.split('\n');
    const today = new Date().toISOString().slice(0,10);
    const categories = ["Admin","Finance","IT","Engineering","Safety","Healthcare","Sales","Drivers"];
    let jobsJSON = {};
    
    // If existing JSON exists, try loading from localStorage
    if(localStorage.getItem('jobsJSON')){
        jobsJSON = JSON.parse(localStorage.getItem('jobsJSON'));
    }

    if(!jobsJSON[today]) {
        jobsJSON[today] = {};
        categories.forEach(cat => jobsJSON[today][cat] = []);
    }

    let currentCategory = null;
    lines.forEach(line => {
        line = line.trim();
        if(line.startsWith('ðŸ“Œ')) {
            // Detect category based on keywords
            if(/secretary|admin|office/i.test(line)) currentCategory = "Admin";
            else if(/finance|account/i.test(line)) currentCategory = "Finance";
            else if(/it|technician|developer/i.test(line)) currentCategory = "IT";
            else if(/engineer|technical|supervisor/i.test(line)) currentCategory = "Engineering";
            else if(/safety/i.test(line)) currentCategory = "Safety";
            else if(/clinic|medical|health/i.test(line)) currentCategory = "Healthcare";
            else if(/sales|marketing/i.test(line)) currentCategory = "Sales";
            else if(/driver|logistics/i.test(line)) currentCategory = "Drivers";
            
            if(currentCategory) jobsJSON[today][currentCategory].push(line);
        } else if(currentCategory && line.length > 0) {
            jobsJSON[today][currentCategory][jobsJSON[today][currentCategory].length-1] += '\n' + line;
        }
    });

    // Save to localStorage for preview (optional)
    localStorage.setItem('jobsJSON', JSON.stringify(jobsJSON, null, 2));

    // Download JSON file
    const blob = new Blob([JSON.stringify(jobsJSON, null, 2)], {type: "application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = "jobs.json";
    a.click();
    URL.revokeObjectURL(url);
    alert('JSON downloaded! Upload to GitHub along with index.html.');
}
</script>
</body>
</html>
