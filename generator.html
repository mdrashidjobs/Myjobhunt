<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Job Index Generator</title>
<style>
body { font-family: Arial, sans-serif; background: #f9f9f9; margin: 20px; }
h1 { text-align: center; }
textarea { width: 100%; height: 300px; padding: 10px; font-size: 14px; }
button { padding: 10px 20px; font-size: 16px; margin-top: 10px; cursor: pointer; }
</style>
</head>
<body>

<h1>Job Index Generator</h1>
<p>Paste today’s raw WhatsApp-formatted jobs below:</p>
<textarea id="jobsInput" placeholder="Paste job ads here..."></textarea>
<br>
<button onclick="generateIndex()">Generate & Download Index File</button>

<script>
function generateIndex() {
    const rawJobs = document.getElementById('jobsInput').value.trim();
    if (!rawJobs) { alert("Please paste job ads first."); return; }

    const today = new Date();
    const dateStr = today.toLocaleDateString('en-GB', { day:'2-digit', month:'long', year:'numeric' });
    const escapedJobs = rawJobs.replace(/`/g,'\\`');

    const indexContent = `
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MY JOB HUNT</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background: #fff; }
h1 { text-align: center; }
hr { border: 1px solid #000; margin: 10px 0; }
.tab { display: none; margin-top: 10px; }
.tab-buttons button { margin-right: 5px; padding: 5px 10px; cursor: pointer; }
.job { margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
.archive-day { border:1px solid #ccc; margin-bottom:10px; }
.archive-header { background:#eee; padding:5px; cursor:pointer; }
.archive-content { display:none; padding:5px; }
@media(max-width:600px){ .job { font-size: 14px; } }
</style>
</head>
<body>

<h1>MY JOB HUNT</h1>
<hr>
<p style="text-align:center;"><strong>${dateStr}</strong></p>
<hr>

<div class="tab-buttons">
<button onclick="showTab('Admin')">Admin</button>
<button onclick="showTab('IT')">IT</button>
<button onclick="showTab('Sales')">Sales</button>
<button onclick="showTab('Medical')">Medical</button>
<button onclick="showTab('Logistics')">Logistics</button>
<button onclick="showTab('Misc')">Misc</button>
<button onclick="showTab('Archive')">Archive</button>
</div>

<div id="Admin" class="tab"></div>
<div id="IT" class="tab"></div>
<div id="Sales" class="tab"></div>
<div id="Medical" class="tab"></div>
<div id="Logistics" class="tab"></div>
<div id="Misc" class="tab"></div>
<div id="Archive" class="tab"></div>

<script>
// Tab switcher
function showTab(name){
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(t => t.style.display='none');
    document.getElementById(name).style.display='block';
}

// Collapse/uncollapse for archive
function toggleArchive(el){
    const content = el.nextElementSibling;
    content.style.display = content.style.display==='none'?'block':'none';
}

// Job parsing & category sorting
(function(){
    const rawJobs = \`${escapedJobs}\`;
    const jobs = rawJobs.split('\\n\\n');
    jobs.forEach(j=>{
        let cat='Misc';
        if(/admin/i.test(j)) cat='Admin';
        else if(/IT|tech/i.test(j)) cat='IT';
        else if(/sales/i.test(j)) cat='Sales';
        else if(/medical|nurse|doctor/i.test(j)) cat='Medical';
        else if(/logistics|warehouse|delivery/i.test(j)) cat='Logistics';

        const div = document.createElement('div');
        div.className='job';
        div.innerHTML = j.replace(/\\n/g,'<br>');
        document.getElementById(cat).appendChild(div);
    });

    // Add today’s jobs to archive
    const archive = document.getElementById('Archive');
    const dayDiv = document.createElement('div');
    dayDiv.className='archive-day';
    const header = document.createElement('div');
    header.className='archive-header';
    header.innerText='${dateStr}';
    header.onclick = function(){ toggleArchive(this); }
    const content = document.createElement('div');
    content.className='archive-content';
    content.innerHTML = rawJobs.replace(/\\n/g,'<br>');
    dayDiv.appendChild(header);
    dayDiv.appendChild(content);
    archive.appendChild(dayDiv);
})();
showTab('Admin');
</script>

<!-- Google AdSense -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-client="ca-pub-3037151964199001"
     data-ad-slot="1234567890"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>(adsbygoogle = window.adsbygoogle || []).push({});</script>

</body>
</html>
`;

    // RELIABLE DOWNLOAD
    const blob = new Blob([indexContent], {type: 'text/html'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'index.html';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    setTimeout(() => URL.revokeObjectURL(url), 100); // ensures download works
}
</script>

</body>
</html>
